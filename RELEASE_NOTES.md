# SuperPicky - 慧眼选鸟 版本发布说明

## V3.2.0 (2025-10-25) - 二次选鸟功能 🔄

### 🎯 重大功能更新

这是一个功能性重大更新，引入了**二次选鸟 (Post Digital Adjustment)** 功能，让用户能够基于已有分析结果快速调整评分标准。

### ✨ 核心新功能

1. **📊 二次选鸟 (Post-DA)**
   - 基于已有CSV数据重新计算星级，**无需重新运行AI推理**
   - 实时预览新星级分布和变化对比
   - 拖动滑块调整阈值（锐度/美学/精选百分比）
   - 批量EXIF写入，快速应用新评分
   - 速度提升：**从5-20分钟降至5-10秒** (60-240倍)

2. **🎚️ 可调节参数**
   - 锐度阈值 (2/3星): 6000-9000
   - 美学阈值 (2/3星): 4.5-5.5
   - 精选旗标百分比: 10%-50%

3. **📈 智能预览**
   - 显示当前星级分布统计
   - 实时计算调整后的新分布
   - 对比显示变化（+/-数量和百分比）
   - 防抖优化（300ms），流畅体验

### 🔧 参数优化

4. **默认阈值调整**
   - 锐度默认值：8000 → 7500（更容易获得优选）
   - 美学默认值：5.0 → 4.8（更容易获得优选）
   - 精选百分比：10% → 25%，范围扩展到10-50%

### 📦 技术实现

- 新增 `PostAdjustmentEngine`: 后端评分计算引擎
- 新增 `PostAdjustmentDialog`: 实时预览UI对话框
- 主界面集成：自动检测report.csv并启用按钮
- 代码量：+1020行（核心功能714行）

### 🎨 用户体验

- 处理完成后自动启用"二次选鸟"按钮
- 浏览目录时自动检测历史数据
- 友好的3区域布局（当前统计/阈值调整/预览对比）
- 完整的进度显示和错误处理

### 📝 使用场景

**场景1：3星照片太少**
```
当前: 3星只有20张
操作: 降低锐度阈值 8000 → 7500
结果: 3星增加到35张 (+15张)
```

**场景2：想要更多精选照片**
```
当前: 精选旗标只有5张
操作: 提高精选百分比 25% → 35%
结果: 精选增加到12张 (+7张)
```

### 📚 文档

- 完整功能说明: `POST_DA_README.md`
- 单元测试: `test_post_da.py`

---

## V3.1.4 (2025-10-25) - 临时文件清理 + 术语优化

### 🎯 本次更新重点

这是一个维护性更新，主要提升用户体验和代码稳定性。

### ✨ 新功能

1. **完整的临时文件清理**
   - 重置功能现在会完整删除 `_tmp` 目录及其所有内容
   - 自动清理遗留的 `tmp_*.jpg` 临时JPEG文件
   - 确保目录重置后不留任何临时文件残留

### 🔧 改进优化

2. **BRISQUE 术语优化**
   - 将"噪点"改为更准确的"失真"描述
   - 更符合 BRISQUE 技术质量评分的实际含义
   - 涉及所有UI显示和文档说明

3. **Bug修复**
   - 修复 `raw_to_jpeg()` 函数返回值问题（`None` → `False`）
   - 提升代码健壮性和错误处理

### 📦 技术细节

- 锐度值格式已优化（08.2f），支持超过 10000 的数值显示
- 移除大文件模型（不再上传到 GitHub，需要本地下载）
- 优化 .gitignore，排除 temp_models/ 目录

---

## V3.1.3 (2025-10-20) - PyIQA 打包优化

### 主要改进

- 优化 PyIQA 模型打包
- 修复打包后的模型加载问题
- 改进构建脚本和文档

---

## V3.1.2 (2025-10-19) - About窗口 + 防休眠 + EXIF优化

### ✨ 新功能

1. **About 窗口**
   - 添加完整的关于窗口，展示软件信息、开源声明和作者信息
   - 菜单栏 → 帮助 → 关于慧眼选鸟

2. **防休眠功能**
   - 处理期间自动防止系统休眠（macOS）
   - 处理完成后自动恢复休眠设置

3. **EXIF 批量写入优化**
   - 优化 ExifTool 批量操作性能
   - 减少不必要的日志输出（避免刷屏）

---

## V3.1.1 (2025-10-18) - 完整优化版本

### 主要改进

- 重写 main.py，优化代码结构
- 移除 PyQt 依赖，纯 Tkinter 实现
- 改进UI布局和用户体验

---

## V3.1.0 (2025-10-17) - YOLO11 + 掩码可视化

### ✨ 重大更新

1. **升级到 YOLO11L 分割模型**
   - 更准确的鸟类检测和分割
   - 支持实例分割掩码

2. **锐度计算优化**
   - 使用对数压缩归一化（V3.1默认）
   - 大小鸟公平评分

---

## V3.0.0 (2025-10-15) - EXIF标记模式 🚀

### 🎯 重大架构变更

从文件移动模式升级到 **EXIF 元数据标记模式**，与 Lightroom/Bridge 无缝集成！

### ✨ 核心功能

1. **智能评分系统**
   - **⭐⭐⭐ 三星**：锐度 + 美学双达标的优选照片
   - **🏆 精选旗标**：3星照片中，美学+锐度双排名 Top 10% 的交集
   - **⭐⭐ 二星**：锐度或美学达标其一
   - **⭐ 一星**：有鸟但质量未达标
   - **0星**：技术质量太差（置信度/失真/美学/锐度不达标）
   - **❌ 拒绝**：完全没鸟

2. **多维度质量评估**
   - **AI 置信度**：YOLO 检测置信度
   - **锐度评分**：拉普拉斯方差，归一化处理（对数压缩/线性等多种模式）
   - **NIMA 美学评分**：深度学习美学质量（0-10分）
   - **BRISQUE 失真评分**：图像技术质量（0-100，越低越好）

3. **EXIF 元数据映射**
   - **Rating（星级）**：-1 / 0 / 1 / 2 / 3 星
   - **Pick（旗标）**：🏆 精选 / 🚫 排除
   - **City（城市）**：锐度值（6000-10000+）
   - **Province-State（省/州）**：NIMA 美学评分（0-10）
   - **Country（国家）**：BRISQUE 失真评分（0-100）

4. **Lightroom Classic 完美集成**
   - 导入照片自动带星级和旗标
   - 已导入照片可"从文件读取元数据"更新评分
   - 支持按星级、旗标筛选
   - 支持按锐度、美学、失真排序

5. **高级配置系统**
   - 可调节所有评分阈值
   - 可调节精选旗标百分比（10%-50%）
   - 配置持久化保存

### 🔧 技术特性

- **ExifTool 集成**：高效批量 EXIF 写入
- **PyIQA 集成**：NIMA 美学 + BRISQUE 失真评估
- **Apple GPU 加速**：支持 MPS 设备（Apple Silicon）
- **RAW 格式支持**：NEF/CR2/ARW 等主流 RAW 格式
- **批量处理**：多线程并行处理，自动防休眠

### 📝 工作流程

```
1. 选择照片目录 → 2. 调整参数（可选） → 3. 开始处理 →
4. 导入Lightroom → 5. 筛选优选照片 → 6. 开始后期！
```

---

## 系统要求

- **操作系统**：macOS 10.15+ / Windows 10+ / Linux
- **Python**：3.8+
- **内存**：建议 8GB+
- **GPU**：支持但非必需（Apple Silicon MPS / NVIDIA CUDA）

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行方式

```bash
python main.py
```

或直接运行打包的应用程序。

---

## 开源许可

本软件基于以下开源项目构建：

- **YOLOv11**: AGPL-3.0 (Ultralytics)
- **PyIQA**: CC BY-NC-SA 4.0 (非商业使用)
- **ExifTool**: Perl Artistic License / GPL

**版权所有 © 2024-2025 詹姆斯·于震 (James Yu)**

仅供个人学习和非商业使用。商业用途请联系作者获取授权。

---

## 致谢

感谢所有开源项目贡献者和鸟类摄影师们的反馈！

**慧眼选鸟 - 让 AI 帮你挑选最美的瞬间 🦅📸**
